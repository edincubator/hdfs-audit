{"paragraphs":[{"text":"%md\n\n# Dataset usage analysis\n\nSelect a dataset from the dropdown list and wait for the result:","user":"admin","dateUpdated":"2018-02-06T17:30:43+0100","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","editorHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Dataset usage analysis</h1>\n<p>Select a dataset from the dropdown list and wait for the result:</p>\n"}]},"apps":[],"jobName":"paragraph_1517914709925_424411296","id":"20180206-115829_1073136295","dateCreated":"2018-02-06T11:58:29+0100","dateStarted":"2018-02-06T17:30:43+0100","dateFinished":"2018-02-06T17:30:43+0100","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:571"},{"text":"%spark2.pyspark\nfrom datetime import datetime\n\nseq = spark.sparkContext.sequenceFile(\"/user/mikel/audit/*/*/*/*.log\")\nvalues = seq.values()\n\ndata = values.filter(lambda x : str(x) != \"==> /var/log/hadoop/hdfs/hdfs-audit.log <==\").map(lambda x: [str(x[:23]), x[x.find('allowed=')+len('allowed='):x.find('\\t', x.find('allowed='))] == 'true', str(x[x.find('ugi=') + len('ugi='):x.find(' ', x.find('ugi'))]), str(x[x.find('ip=') + len('ip='):x.find('\\t', x.find('ip'))]), str(x[x.find('cmd=') + len('cmd='):x.find('\\t', x.find('cmd'))]), str(x[x.find('src=') + len('src='):x.find('\\t', x.find('src'))])])\n\ndata = data.filter(lambda x: x[0] != '')\ndata = data.map(lambda x: [datetime.strptime(x[0], '%Y-%m-%d %H:%M:%S,%f'), x[1], x[2], x[3], x[4], x[5]])\n\ndf = spark.createDataFrame(data, [\"timestamp\", \"allowed\", \"user\", \"ip\", \"command\", \"path\"])\n\ndf.registerTempTable('data')","user":"admin","dateUpdated":"2018-02-07T11:24:05+0100","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python","editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1517846081414_-255558128","id":"20180205-165441_1626668854","dateCreated":"2018-02-05T16:54:41+0100","dateStarted":"2018-02-06T17:30:43+0100","dateFinished":"2018-02-06T17:30:43+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:572"},{"text":"%spark2.sql\n\nselect timestamp, allowed, user, ip, command, path from data where path=\"${Dataset=/user/mikel/pi,/user/mikel/pi|/user/mikel/pi2|/user/mikel/randomtext}\"","user":"admin","dateUpdated":"2018-02-06T17:32:38+0100","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":true,"setting":{"pieChart":{},"multiBarChart":{}},"commonSetting":{},"keys":[{"name":"command","index":4,"aggr":"sum"}],"groups":[],"values":[{"name":"command","index":4,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql","runOnSelectionChange":true,"editorHide":true},"settings":{"params":{"path":"/user/mikel/pi","Dataset":"/user/mikel/pi"},"forms":{"Dataset":{"name":"Dataset","defaultValue":"/user/mikel/pi","options":[{"value":"/user/mikel/pi","$$hashKey":"object:661"},{"value":"/user/mikel/pi2","$$hashKey":"object:662"},{"value":"/user/mikel/randomtext","$$hashKey":"object:663"}],"hidden":false,"$$hashKey":"object:653"}}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"timestamp\tallowed\tuser\tip\tcommand\tpath\n2018-02-06 17:14:16.85\ttrue\tmikel\t/192.168.125.113\tgetfileinfo\t/user/mikel/pi\n2018-02-06 17:14:16.965\ttrue\tmikel\t/192.168.125.113\tlistStatus\t/user/mikel/pi\n"}]},"apps":[],"jobName":"paragraph_1517909867257_933553469","id":"20180206-103747_2052381246","dateCreated":"2018-02-06T10:37:47+0100","dateStarted":"2018-02-06T17:32:00+0100","dateFinished":"2018-02-06T17:32:08+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:573"},{"text":"%spark2.sql\n","user":"admin","dateUpdated":"2018-02-06T17:30:43+0100","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1517934332430_-1881427586","id":"20180206-172532_1249914392","dateCreated":"2018-02-06T17:25:32+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:574"}],"name":"hdfs-audit","id":"2D7UBNH4H","angularObjects":{"2CHS8UYQQ:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CK8A9MEG:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}